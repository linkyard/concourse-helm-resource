# Helm Resource for Concourse

Deploy to [Kubernetes Helm](https://github.com/kubernetes/helm) from [Concourse](https://concourse.ci/).

## Installing

Add the resource type to your pipeline:
```
resource_types:
- name: helm
  type: docker-image
  source:
    repository: linkyard/helm-resource
```


## Source Configuration

* `cluster_url`: *Required.* URL to Kubernetes Master API service
* `cluster_ca`: *Optional.* Base64 encoded PEM. Required if `cluster_url` is https.
* `admin_key`: *Optional.* Base64 encoded PEM. Required if `cluster_url` is https.
* `admin_cert`: *Optional.* Base64 encoded PEM. Required if `cluster_url` is https.
* `release`: *Optional.* Name of the release (not a file, a string). (Default: autogenerated by helm)


## Behavior

### `check`: Not supported.

### `in`: Not Supported

### `out`: Deploy the helm chart

Deploys a Helm chart onto the Kubernetes cluster. Tiller must be already installed
on the cluster.

#### Parameters
* `chart`: *Required.* File containing the helm chart to deploy (.tgz).
* `release`: *Optional.* File containing the name of the release. (Default: taken from source configuration).
* `values`: *Optional.* File containing the values.yaml for the deployment.
* `delete`: *Optional.* Deletes the release instead of installing it. Requires the `name`. (Default: false)
* `replace`: *Optional.* Replace deleted release with same name. (Default: false)
* `wait_until_ready`: *Optional.* Set to the number of seconds it should wait until all the resources in
    the chart are ready. (Default: `0` which means don't wait).



## Example

### Out
```
resources:
- name: myapp-helm
  type: helm
  source:
    cluster_url: https://kube-master.domain.example
    cluster_ca: _base64 encoded CA pem_
    admin_key: _base64 encoded key pem_
    admin_cert: _base64 encoded certificate pem_
```

```
- put: myapp-helm
  params:
    chart: source-repo/chart-0.0.1.tgz
    values: source-repo/values.yaml
```